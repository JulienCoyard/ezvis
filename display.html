{% extends "layout.html" %}

{% block content %}
{% if config.pages.display.help %}
<div class="row lead">
    {{ config.pages.display.help | markdown }}
</div>
{% endif %}<div class="title">
    <h2 itemprop="name">
        {{ data.title|d('no title') }}
    </h2>
</div>

<div class="panel-body">
  <div class="table-responsive">
    <table class="table table-striped table-bordered table-hover" id="dataTables-documents">
      <thead>
        <tr>
          <th>Order</th>
          <th>Field</th>
          <th>Value</th>
        </tr>
      </thead>

      <tbody>
      {% if config.display.fields %}
      {% for path, label in config.display.fields %}
      <tr>
        <td>{{loop.index}}</td>
        <td>{{label}}</td>
        <td>{{data|objectPath(path)}}</td>
      </tr>
      {% endfor %}
      {% else %}
      {% set  champs = data|flatten %}
      {% for k,v in champs %}
      {% if (k.slice(2).slice(0,3) != '_id') %}
      <tr>
        <td>{{loop.index}}</td>
        <td>{{k.slice(2)}}</td>
        <td>{{v}}</td>
      </tr>
      {% endif %}
      {% endfor %}
      {% endif %}
    </tbody>

  </table>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script type="text/javascript">
$(document).ready(function() {
  var table = $('#dataTables-documents')
  .DataTable({
    "lengthMenu": [
      [{{config.display.fieldsPerPage|d(10)}}, -1],
      [{{config.display.fieldsPerPage|d(10)}}, "All"]
    ],
    "columnDefs": [{
      "render" : function addLink(data, type, row) {
        if (data.slice(0,7) === 'http://' || data.slice(0,8) === 'https://') {
          return '<a href="' + data + '">' + data + '</a>';
        }
        else {
          return data;
        }
      },
      "targets" : 2
    }]
  });
  table.column(0).visible(false);
});
</script>
{% endblock %}
